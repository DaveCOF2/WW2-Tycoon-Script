-- WW2 Tycoon Script v6.5: Autoâ€‘Collect Cash with Cash Threshold Feature

local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/Hosvile/Refinement/main/MC%3AArrayfield%20Library"))()

local Window = Library:CreateWindow({
    Name = "ðŸ”¥ WW2 Tycoon Script ðŸ”¥",
    ConfigurationSaving = { Enabled = false }
})

-- Tabs
local TabInfo     = Window:CreateTab("â„¹ï¸ Info")
local TabTycoon   = Window:CreateTab("ðŸ­ Tycoon")
local TabAdvanced = Window:CreateTab("âš™ï¸ Advanced")
local TabMisc     = Window:CreateTab("ðŸ§° Misc")
local TabCheats   = Window:CreateTab("ðŸ‘¾ Player Cheats")
local TabCredits  = Window:CreateTab("ðŸ‘‘ Credits")

-- Services & References
local Players          = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService       = game:GetService("RunService")
local LocalPlayer      = Players.LocalPlayer
local TycoonsFolder    = workspace:FindFirstChild("Tycoon Systems") and workspace["Tycoon Systems"].Factory.Tycoons

-- Utility: find your tycoon
local function getPlayerTycoon()
    for _, tycoon in ipairs(TycoonsFolder:GetChildren()) do
        if tycoon.Owner and tycoon.Owner.Value == LocalPlayer then
            return tycoon
        end
    end
    return nil
end

-- ===== INFO TAB =====
local InfoSection = TabInfo:CreateSection("âœ¨ Welcome & Usage âœ¨", false)
TabInfo:CreateLabel("ðŸ“‹ Overview", InfoSection)
TabInfo:CreateParagraph({
    Title = "ðŸš€ Quick Start Guide",
    Content = [[
1. ðŸ­ Tycoon â†’ Toggle autoâ€‘collect, autoâ€‘buy, autoâ€‘cash features  
2. âš™ï¸ Advanced â†’ Optimize performance & Enable Antiâ€‘AFK  
3. ðŸ‘¾ Cheats â†’ Enhance movement & utility features  
4. ðŸ”„ Reset Character â†’ Force respawn if you get stuck

This premium script automatically manages your tycoon operations for maximum profits!
]]
}, InfoSection)
TabInfo:CreateParagraph({
    Title = "ðŸ“Œ Requirements",
    Content = "You must own a tycoon to use this script. The system automatically detects your tycoon by matching your Player object with the tycoon owner."
}, InfoSection)

-- ===== TYCOON TAB =====
local TycoonSection = TabTycoon:CreateSection("ðŸ’° Autoâ€‘Tycoon Controls ðŸ’°", false)

-- Autoâ€‘Collect Droppers
local droppers = {
    { id = "d5",  label = "Basic Dropper",    desc = "Collects 5$ each cycle. Perfect for starting out!" },
    { id = "d10", label = "Advanced Dropper", desc = "Collects 10$ each cycle. Double the income!" },
    { id = "d15", label = "Super Dropper",    desc = "Collects 15$ each cycle. Triple your profits!" },
    { id = "d21", label = "Ultimate Dropper", desc = "Collects 21$ each cycle. Maximum earnings potential!" },
}
for _, drop in ipairs(droppers) do
    local active = false
    TabTycoon:CreateToggle({
        Name = "ðŸ”„ Auto " .. drop.label,
        CurrentValue = false,
        SectionParent = TycoonSection,
        Info = { Title = "ðŸ’Ž " .. drop.label, Description = drop.desc },
        Callback = function(on)
            active = on
            if on then
                task.spawn(function()
                    while active do
                        local ty = getPlayerTycoon()
                        if ty and ty.CollectorEvent then
                            ty.CollectorEvent:FireServer(drop.id, "{}")
                        end
                        task.wait(0.05)
                    end
                end)
            end
        end,
    })
end

-- Autoâ€‘Buy Upgrades
local buyActive = false
TabTycoon:CreateToggle({
    Name = "ðŸ›’ Auto Buy Upgrades",
    CurrentValue = false,
    SectionParent = TycoonSection,
    Info = {
        Title = "ðŸ›’ Auto Buy Upgrades",
        Description = "Automatically purchases any available upgrade pads for you. Maximize your tycoon's potential without any manual work!"
    },
    Callback = function(on)
        buyActive = on
        if on then
            task.spawn(function()
                while buyActive do
                    local ty = getPlayerTycoon()
                    if ty then
                        for _, part in ipairs(ty:GetDescendants()) do
                            if part.Name == "Head"
                              and part:IsA("BasePart")
                              and part.BrickColor == BrickColor.new("Shamrock") then
                                local root = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
                                if root then
                                    root.CFrame = part.CFrame + Vector3.new(0, 5, 0)
                                    task.wait(1)  -- Added 1 second wait after purchasing before teleporting to the next one
                                end
                            end
                        end
                    end
                    task.wait(2)  -- Increased delay between upgrade checks to avoid overlap
                end
            end)
        end
    end,
})

-- Cash value tracking variables
local isAutoCollecting = false
local cashThreshold = 0
local useThreshold = false
local cashCheckFrequency = 2

-- Cash threshold input
TabTycoon:CreateInput({
    Name = "ðŸ’µ Cash Threshold",
    PlaceholderText = "e.g. 10000",
    NumbersOnly = true,
    RemoveTextAfterFocusLost = false,
    SectionParent = TycoonSection,
    Info = {
        Title = "ðŸ’µ Cash Threshold",
        Description = "Set the cash amount to collect at. Player will be teleported to collect cash only when this value is reached or exceeded. Great for maximizing large collections!"
    },
    Callback = function(text)
        local val = tonumber(text)
        if val then
            cashThreshold = val
            print("Cash threshold set to: $" .. cashThreshold)
        end
    end
})

-- Toggle for using threshold
TabTycoon:CreateToggle({
    Name = "âš–ï¸ Use Cash Threshold",
    CurrentValue = false,
    SectionParent = TycoonSection,
    Info = {
        Title = "âš–ï¸ Use Cash Threshold",
        Description = "When enabled, auto-collect will only trigger at the specified cash threshold. Optimize your collection timing!"
    },
    Callback = function(on)
        useThreshold = on
    end
})

-- Function to get current cash value from the text label
local function getCurrentCashValue()
    local tycoon = getPlayerTycoon()
    if not tycoon then return 0 end
    
    local cashLabel = tycoon:FindFirstChild("Essentials") 
        and tycoon.Essentials:FindFirstChild("Giver")
        and tycoon.Essentials.Giver:FindFirstChild("CashScreen")
        and tycoon.Essentials.Giver.CashScreen:FindFirstChild("SurfaceGui")
        and tycoon.Essentials.Giver.CashScreen.SurfaceGui:FindFirstChild("TextLabel")
    
    if cashLabel then
        -- Extract numeric value from text (remove "$" and any other non-numeric characters)
        local cashText = cashLabel.Text
        local cashValue = cashText:gsub("[^%d]", "")
        return tonumber(cashValue) or 0
    end
    
    return 0
end

-- Auto Collect Cash with threshold logic
TabTycoon:CreateToggle({
    Name = "ðŸ’° Auto Collect Cash",
    CurrentValue = false,
    SectionParent = TycoonSection,
    Info = {
        Title = "ðŸ’° Auto Collect Cash",
        Description = "Teleports your character to the cash collector. Can be configured to trigger only at a specific cash threshold. Never worry about collecting cash again!"
    },
    Callback = function(enabled)
        isAutoCollecting = enabled
        if enabled then
            task.spawn(function()
                while isAutoCollecting do
                    local tycoon = getPlayerTycoon()
                    if tycoon then
                        local currentCash = getCurrentCashValue()
                        local shouldCollect = not useThreshold or (currentCash >= cashThreshold)
                        
                        if shouldCollect then
                            local givePart = tycoon:FindFirstChild("Essentials")
                                and tycoon.Essentials:FindFirstChild("Giver")
                                and tycoon.Essentials.Giver:FindFirstChild("GivePart")

                            if givePart then
                                local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
                                if hrp then
                                    hrp.CFrame = CFrame.new(givePart.Position + Vector3.new(0, 5, 0)) * CFrame.Angles(0, math.rad(180), 0)
                                    print("Collecting cash: $" .. currentCash)
                                end
                            end
                        end
                    end
                    task.wait(cashCheckFrequency)  -- Use the user-defined check frequency
                end
            end)
        end
    end
})

-- ===== ADVANCED TAB =====
local AdvSection = TabAdvanced:CreateSection("âš¡ Performance & AFK Settings âš¡", false)
TabAdvanced:CreateParagraph({
    Title = "â±ï¸ Interval Tuning",
    Content = [[
â€“ Default delay between collects is 0.05s (fastest, higher CPU usage).  
â€“ Increase to 0.1 or 0.2 to reduce lag on slower systems.
â€“ Find the perfect balance between speed and performance!
]]
}, AdvSection)
TabAdvanced:CreateToggle({
    Name = "ðŸ”„ Antiâ€‘AFK",
    CurrentValue = true,
    SectionParent = AdvSection,
    Info = {
        Title = "ðŸ”„ Antiâ€‘AFK",
        Description = "Prevents idle kick by simulating slight mouse movement. Stay in the game indefinitely!"
    },
    Callback = function(on)
        if on then
            LocalPlayer.Idled:Connect(function()
                UserInputService:SendInputEvent(Enum.UserInputType.MouseMovement)
            end)
        end
    end
})

-- Cash collector frequency setting
TabAdvanced:CreateInput({
    Name = "â²ï¸ Cash Check Frequency",
    PlaceholderText = "2",
    NumbersOnly = true,
    RemoveTextAfterFocusLost = false,
    SectionParent = AdvSection,
    Info = {
        Title = "â²ï¸ Cash Check Frequency",
        Description = "How often to check the cash value (in seconds). Lower values mean more frequent checks but higher CPU usage."
    },
    Callback = function(text)
        local val = tonumber(text)
        if val and val >= 1 then
            cashCheckFrequency = val
            print("Cash check frequency set to: " .. val .. " seconds")
        end
    end
})

-- ===== MISC TAB =====
local MiscSection = TabMisc:CreateSection("ðŸŽ® Extra Features ðŸŽ®", false)
TabMisc:CreateLabel("â€¢ ðŸš© Auto Team Selector (coming soon)", MiscSection)
TabMisc:CreateLabel("â€¢ ðŸ† Autoâ€‘Upgrade Claim (coming soon)", MiscSection)
TabMisc:CreateLabel("â€¢ ðŸŽ¯ Auto-Target System (coming soon)", MiscSection)
TabMisc:CreateLabel("â€¢ ðŸ”” Notification System (coming soon)", MiscSection)

-- Add Cash Value Display
local CashMonitorSection = TabMisc:CreateSection("ðŸ’µ Cash Monitor ðŸ’µ", false)
local cashDisplayLabel = TabMisc:CreateLabel("Current Cash: $0", CashMonitorSection)

-- Update cash display periodically
task.spawn(function()
    while true do
        local cash = getCurrentCashValue()
        if cashDisplayLabel then
            cashDisplayLabel:Set("ðŸ’° Current Cash: $" .. tostring(cash))
        end
        task.wait(1)
    end
end)

-- ===== PLAYER CHEATS TAB =====
local CheatSection = TabCheats:CreateSection("ðŸ”§ Movement & Utility Enhancements ðŸ”§", false)

-- Walk Speed Input
TabCheats:CreateInput({
    Name = "ðŸƒ Walk Speed",
    PlaceholderText = "e.g. 16",
    NumbersOnly = true,
    RemoveTextAfterFocusLost = false,
    SectionParent = CheatSection,
    Info = {
        Title = "ðŸƒ Walk Speed",
        Description = "Set your character's walking speed (default 16). Higher values make you move faster! Try 50 for a big boost."
    },
    Callback = function(text)
        local val = tonumber(text)
        if val and LocalPlayer.Character then
            local hum = LocalPlayer.Character:FindFirstChild("Humanoid")
            if hum then hum.WalkSpeed = val end
        end
    end
})

-- Infinite Jump
local infJump = false
TabCheats:CreateToggle({
    Name = "ðŸ¦˜ Infinite Jump",
    CurrentValue = false,
    SectionParent = CheatSection,
    Info = {
        Title = "ðŸ¦˜ Infinite Jump",
        Description = "Allows repeated midâ€‘air jumps whenever you press Space. Reach any height with ease!"
    },
    Callback = function(on) infJump = on end
})
UserInputService.JumpRequest:Connect(function()
    if infJump and LocalPlayer.Character then
        LocalPlayer.Character:FindFirstChildOfClass("Humanoid"):ChangeState(Enum.HumanoidStateType.Jumping)
    end
end)

-- Noclip
local noclipConn
TabCheats:CreateToggle({
    Name = "ðŸ‘» Noclip",
    CurrentValue = false,
    SectionParent = CheatSection,
    Info = {
        Title = "ðŸ‘» Noclip",
        Description = "Disable collisions on your character to phase through walls and objects. Perfect for exploring or escaping tight spaces!"
    },
    Callback = function(on)
        if on then
            noclipConn = RunService.Stepped:Connect(function()
                if LocalPlayer.Character then
                    for _, p in pairs(LocalPlayer.Character:GetDescendants()) do
                        if p:IsA("BasePart") then p.CanCollide = false end
                    end
                end
            end)
        elseif noclipConn then
            noclipConn:Disconnect()
        end
    end
})

-- Teleport to Tycoon
TabCheats:CreateButton({
    Name = "ðŸ  Teleport to Tycoon",
    SectionParent = CheatSection,
    Info = {
        Title = "ðŸ  Teleport to Tycoon",
        Description = "Instantly move you to your tycoon's spawn pad. Perfect for getting back to base quickly!"
    },
    Callback = function()
        local ty = getPlayerTycoon()
        local root = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        if ty and root and ty:FindFirstChild("SpawnLocation") then
            root.CFrame = ty.SpawnLocation.CFrame + Vector3.new(0,5,0)
        end
    end
})

-- Reset Character
TabCheats:CreateButton({
    Name = "ðŸ”„ Reset Character",
    SectionParent = CheatSection,
    Info = {
        Title = "ðŸ”„ Reset Character",
        Description = "Forceâ€‘respawn your character to escape traps, glitches, or stuck positions. Use this if you get trapped!"
    },
    Callback = function()
        local h = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid")
        if h then
            h.Health = 0
        else
            LocalPlayer:LoadCharacter()
        end
    end
})

-- ===== CREDITS TAB =====
local CreditsSection = TabCredits:CreateSection("ðŸŒŸ Script Information ðŸŒŸ", false)
TabCredits:CreateParagraph({
    Title = "ðŸ§™â€â™‚ï¸ Created and Modified By",
    Content = "DaveCOF2"
}, CreditsSection)
TabCredits:CreateParagraph({
    Title = "ðŸ› ï¸ UI Library",
    Content = "ArrayField Interface Suite by Meta & Sirius"
}, CreditsSection)
TabCredits:CreateParagraph({
    Title = "ðŸ“Š Version Information",
    Content = "v6.5 - Premium Edition with cash threshold collection and enhanced UI"
}, CreditsSection)
TabCredits:CreateParagraph({
    Title = "ðŸ“œ Script Description",
    Content = "This premium script automates all aspects of WW2 Tycoon gameplay, featuring smart cash collection with threshold settings, auto-upgrading capabilities, and player enhancement tools. Built for efficiency and performance!"
}, CreditsSection)
TabCredits:CreateParagraph({
    Title = "ðŸ’» Technical Details",
    Content = "Optimized code structure with minimal resource usage. Compatible with all executor types."
}, CreditsSection)

Window:Show()
